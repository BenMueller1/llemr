<!DOCTYPE html>

{% load static %}

<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang=""> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8" lang=""> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9" lang=""> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang=""> <!--<![endif]-->
<head>
	<meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <title>{% block title %}{% endblock %}</title>

  <!-- Bootstrap -->
	<link rel="stylesheet" href={% static "css/bootstrap.min.css" %}>
  <link rel="stylesheet" href={% static "css/bootstrap-theme.min.css" %}>
  <link rel="stylesheet" href={% static "css/autocomplete_light/styles.css" %}>

	<script src={% static "js/jquery-1.11.2.min.js" %}></script>
  <script src={% static "js/bootstrap.min.js" %}></script>
<script>  
//prevent med options from loading when click on prescription input fields
$(document).ready(function() {
    
  $('#id_allergies').on('input', function() {
      let $this = $(this)
      let $clone = $this.clone()

    //       let name = $clone.attr('name')
    // let n = parseInt(name.split('_')[1]) + 1
    // name = 'interest_' + n
    // $clone.val('')
    // $clone.attr('name', name)
    $clone.appendTo($this.parent())
    // $this.removeClass('interest-list-new')
    $this.off('input', arguments.callee)
    $clone.on('input', arguments.callee)
})


  $("#div_id_meds").click(function(event){
      // console.log(( "clicked: " + event.target.className )); 
      var selectedElement = event.target
      if(selectedElement.className == "med-input"){  
          selectedElement.focus();
          // console.log($(event.target))
          $(selectedElement).focusout(function() {
            //save input values to data holder on click out
            // console.log($("option:contains('Alfentanil')").text())
            saveInput(selectedElement,selectedElement.name)
          })
          $(document).on('select2:opening', function (e) {
            e.preventDefault();
            $(document).off('select2:opening');
          });
      }
      else{
        // repopulate input fields from dataHolder
        $(document).on('select2:select', function (e) {
          console.log("render")
          $(".select2-selection__choice").each(function(){
              dataHolderElement = $("option:contains('"+this.title+"')")
              $(this).children().children().each(function(){
                inputAttribute = $(this).children().attr('name')
                inputElement = $(this).children().get(0)
                inputElement.value = dataHolderElement.attr(inputAttribute);
                // console.log($(this).children().get(0))
                console.log('filling')
              })
          });
        });
      }
    });
  });

function saveInput(inputElement){
  element = inputElement.parentElement.parentElement.parentElement
  dataHolderElement = $("option:contains('"+element.title+"')")
  if(inputElement.name == "dose"){
    dataHolderElement.attr('dose', $(inputElement).val());
  }  
  else if(inputElement.name == "route"){
    dataHolderElement.attr('route', $(inputElement).val());
  }
  else if(inputElement.name == "freq"){
    dataHolderElement.attr('freq', $(inputElement).val());
  }  
}

function saveMed(){
  console.log("saved")
  option = document.createElement("option")
  option.setAttribute("value","3")
  option.innerHTML = "hacky, hack"
  document.getElementById("id_allergies").appendChild(option)
}

              // console.log(dataHolderElement)

              // // console.log($(this).find("input[name*='dose']"))
              // fn = $(this).find("input[name*='dose']").get(0);
              // if(fn){
              //   console.log("works")
              //   fn.placeholder = "stirng"
              // }

              // console.log(dataHolderElement.attr('dose'))
              // console.log(fn)
</script>




  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

  {{ form.media }}

  {% block extra_head %}
  {% endblock %}

  <style>
    body {
      padding-top: 50px;
      padding-bottom: 5%;
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="{% url 'home' %}">Osler Home</a>
      </div>
      <div class="collapse navbar-collapse" id="myNavbar">
        <ul class="nav navbar-nav">
          <li><a href="{% url 'core:preintake' %}">New Patient</a></li>
          <li><a href="{% url 'core:all-patients' %}">All Patients</a></li>
          <li><a href="{% url 'dashboard-active' %}">Active Patients</a></li>
          <li><a href="{% url 'inventory:drug-list' %}">Drug Inventory</a></li>
          {% if settings.OSLER_DISPLAY_APPOINTMENTS %}
            <li><a href="{% url 'appointment-list' %}">Appointments</a></li>
          {% endif %}
          {% if settings.OSLER_DISPLAY_ATTENDANCE %}
            <li><a href={{ settings.OSLER_ATTENDANCE_URL }} target="_blank">Attendance</a></li>
          {% endif %}
           <li><a href="{% url 'about' %}" target="_blank">{{settings.OSLER_ABOUT_NAME}} </a></li>
        </ul>
				{% if user.is_authenticated %}
				<ul class="nav navbar-nav pull-right">
            {% if user.is_superuser %}
            <li><a href="{% url 'admin:index' %}">Admin</a></li>
            {% endif %}
            <li><a href="{% url 'account_logout' %}">Logout
              {{ request.user }} ({{ request.session.active_role_name | default:"no role" }})
            </a></li>
        </ul>
        {% endif %}
      </div><!--/.nav-collapse -->
    </div>
  </nav>

  <!--[if lt IE 7]>
	<p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
	<![endif]-->

  <div class="jumbotron">
	<div class="container">
	{% block header %}{% endblock %}
	</div>
	</div>

  {% if messages %}
    {% for message in messages %}
      <div class="alert {% if message.tags %}{{ message.tags }}{% endif %}" role="alert">
        <p>{{ message }}</p>
      </div>
    {% endfor %}
  {% endif %}

	{% block content %}{% endblock %}

  {% block extra_js %}
      {# Override this in templates to add extra javascript #}
  {% endblock %}

  <footer class="container" style="padding-top: 5%">
    <p class="text-muted">Osler is free and open source software built by WashU students. To learn more or contribute, find us on <a src="https://github.com/oslerproject/osler">GitHub</a>.</p>
  </footer>

  </body>
</html>
